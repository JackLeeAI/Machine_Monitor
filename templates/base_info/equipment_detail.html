<!-- templates/base_info/equipment_detail.html -->
{% extends "base.html" %}

{% block title %}设备详情 - 机器设备在线监控系统{% endblock %}

{% block extra_css %}
<style>
/* 页面容器 */
.equipment-detail-container {
    padding: 20px;
    background-color: #f8f9fa;
    min-height: calc(100vh - 80px);
}

/* 设备基本信息卡片 */
.equipment-basic {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
    padding: 30px;
    margin-bottom: 20px;
}

/* 设备图片样式 */
.equipment-image {
    margin-bottom: 20px;
    text-align: center;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.device-image {
    max-width: 100%;
    height: auto;
    display: block;
}

/* 标题样式 */
.equipment-basic h2 {
    font-size: 20px;
    font-weight: 600;
    color: #343a40;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}

/* 表格样式 */
.equipment-basic table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.equipment-basic table th,
.equipment-basic table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
}

.equipment-basic table th {
    background-color: #f8f9fa;
    font-weight: 500;
    color: #495057;
    width: 25%;
}

.equipment-basic table td {
    color: #343a40;
}

/* 状态标签 */
.status-using {
    padding: 2px 8px;
    background-color: #d4edda;
    color: #155724;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.status-stock {
    padding: 2px 8px;
    background-color: #d1ecf1;
    color: #0c5460;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.status-online {
    padding: 2px 8px;
    background-color: #d4edda;
    color: #155724;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.status-offline {
    padding: 2px 8px;
    background-color: #f8d7da;
    color: #721c24;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

/* 监控点部分 */
.monitor-points {
    margin-top: 30px;
}

.monitor-points h3 {
    font-size: 16px;
    font-weight: 600;
    color: #343a40;
    margin-bottom: 15px;
}

/* 监控点表格 */
.monitor-points table {
    width: 100%;
    border-collapse: collapse;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    overflow: hidden;
}

.monitor-points table th,
.monitor-points table td {
    padding: 10px 12px;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
}

.monitor-points table th {
    background-color: #f8f9fa;
    font-weight: 500;
    color: #495057;
    font-size: 13px;
}

.monitor-points table td {
    color: #343a40;
    font-size: 13px;
}

/* 空数据提示 */
.no-data {
    text-align: center;
    padding: 40px 0;
    color: #6c757d;
    font-size: 14px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

/* 错误提示 */
.error-tip {
    color: #dc3545;
    font-size: 14px;
    text-align: center;
    padding: 40px 0;
}

/* 返回按钮 */
.btn-back {
    display: inline-block;
    padding: 8px 20px;
    background-color: #6c757d;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    text-decoration: none;
    margin-top: 20px;
    transition: background-color 0.3s ease;
}

.btn-back:hover {
    background-color: #5a6268;
    color: white;
}
</style>
{% endblock %}

{% block content %}
<div class="equipment-detail-container">
    <!-- 设备基本信息 -->
    <div class="equipment-basic">
        <!-- 设备图片 -->
        <div class="equipment-image">
            <img src="https://via.placeholder.com/800x300?text=设备+{{ equipment.name if equipment else '图片' }}" alt="设备图片" class="device-image">
        </div>
        <h2>设备详情</h2>
        {% if equipment %}
            <table class="table table-bordered">
                <tr>
                    <th width="20%">设备ID</th>
                    <td>{{ equipment.id }}</td>
                </tr>
                <tr>
                    <th>设备名称</th>
                    <td>{{ equipment.name }}</td>
                </tr>
                <tr>
                    <th>安装车间名称</th>
                    <td>{{ equipment.pos_name | default('未分配') }}</td>
                </tr>
                <tr>
                    <th>负责人ID</th>
                    <td>{{ equipment.person_id | default('未指定') }}</td>
                </tr>
                <tr>
                    <th>负责人姓名</th>
                    <td>{{ equipment.person_name | default('未指定') }}</td>
                </tr>
                <tr>
                    <th>采购（购买）日期</th>
                    <td>{{ equipment.pur_date if equipment.pur_date else '未记录' }}</td>
                </tr>
                <tr>
                    <th>首次使用日期</th>
                    <td>{{ equipment.first_time | default('未记录') }}</td>
                </tr>
                <tr>
                    <th>最后心跳时间</th>
                    <td>{{ equipment.last_heartbeat | default('无') }}</td>
                </tr>
                <tr>
                    <th>使用状态</th>
                    <td>
                        {% if equipment.use_state == '在用' %}
                            <span class="status-using">在用</span>
                        {% elif equipment.use_state == '在库' %}
                            <span class="status-stock">在库</span>
                        {% else %}
                            {{ equipment.use_state | default('未知') }}
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>在线状态</th>
                    <td>
                        {% if equipment.online_status == '在线' %}
                            <span class="status-online">在线</span>
                        {% else %}
                            <span class="status-offline">离线</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>所属车间ID</th>
                    <td>{{ equipment.pos_id | default('未分配') }}</td>
                </tr>
            </table>

            <!-- 设备关联的监控点 -->
            <div class="monitor-points mt-4">
                <h3>关联监控点</h3>
                {% if monitor_points and monitor_points|length > 0 %}
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                    <th>监控点ID</th>
                                    <th>监控点名称</th>
                                    <th>传感器类型</th>
                                    <th>单位</th>
                                    <th>采样频率</th>
                                    <th>采样时长</th>
                                    <th>所属部件</th>
                                    <th>最新数据值</th>
                                    <th>最新数据时间</th>
                                    <th>负责人</th>
                                </tr>
                        </thead>
                        <tbody>
                            {% for point in monitor_points %}
                                <tr>
                                    <td>{{ point.id }}</td>
                                    <td>{{ point.name | default('无') }}</td>
                                    <td>{{ point.sense_name | default(point.sense_type | default('无')) }}</td>
                                    <td>{{ point.unit | default('无') }}</td>
                                    <td>{{ point.sample_freq | default('无') }}</td>
                                    <td>{{ point.sample_long | default('无') }}</td>
                                    <td>{{ point.part_name | default('无') }}</td>
                                    <td>
                                        {% if latest_data and latest_data[point.id] %}
                                            {{ latest_data[point.id].value }}
                                        {% else %}
                                            暂无数据
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if latest_data and latest_data[point.id] %}
                                            {{ latest_data[point.id].collect_time }}
                                        {% else %}
                                            暂无数据
                                        {% endif %}
                                    </td>
                                    <td>{{ point.admin_name | default(point.admin_peron | default('无')) }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="no-data">该设备暂无关联监控点</p>
                {% endif %}
            </div>
        {% else %}
            <p class="error-tip">设备信息不存在！</p>
        {% endif %}

        <!-- 返回按钮 -->
        <a href="{{ url_for('monitor.realtime') }}" class="btn-back">返回实时监控</a>
        <a href="{{ url_for('base_info.equipment_list') }}" class="btn-back" style="margin-left: 10px;">返回设备管理</a>
    </div>
</div>

<!-- 极简美化样式（保留简洁，仅优化可读性） -->
<style>
.equipment-detail-container {
    width: 80%;
    margin: 20px auto;
    padding: 20px;
}

/* 设备图片样式 */
.equipment-image {
    margin-bottom: 20px;
    text-align: center;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.device-image {
    width: 100%;
    height: auto;
    max-height: 300px;
    object-fit: cover;
    display: block;
}
/* 基础表格样式 */
.table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    font-size: 14px;
}
.table th, .table td {
    border: 1px solid #ddd;
    padding: 10px 12px;
    text-align: left;
}
.table th {
    background-color: #f5f5f5;
    font-weight: normal;
}
/* 状态样式（小幅美化，不夸张） */
.status-online {
    color: #28a745;
    font-weight: 500;
}
.status-offline {
    color: #dc3545;
    font-weight: 500;
}
/* 提示文本样式 */
.no-data {
    color: #666;
    padding: 10px 0;
    margin: 0;
}
.error-tip {
    color: #dc3545;
    padding: 10px 0;
    margin: 0;
}
/* 按钮样式（保留简洁，优化点击体验） */
.btn-back {
    display: inline-block;
    margin-top: 20px;
    padding: 8px 20px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    border: none;
    cursor: pointer;
}
.btn-back:hover {
    background-color: #0056b3;
    color: white;
    text-decoration: none;
}
/* 间距优化 */
.mt-4 {
    margin-top: 20px;
}
h2 {
    color: #333;
    font-size: 20px;
    margin-bottom: 15px;
}
h3 {
    color: #333;
    font-size: 18px;
    margin-bottom: 15px;
}
</style>
{% endblock %}